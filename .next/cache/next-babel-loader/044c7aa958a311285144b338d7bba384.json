{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  mutation scriptTagCreate($input: ScriptTagInput!) {\\n    scriptTagCreate(input: $input) {\\n      scriptTag {\\n        id\\n      }\\n      userErrors {\\n        field\\n        message\\n      }\\n    }\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport { Layout, Page, ButtonGroup, Button, Toast, Frame } from '@shopify/polaris';\nimport { useState, useCallback } from 'react';\nimport gql from 'graphql-tag';\nimport { useMutation, useSubscription } from 'react-apollo';\nimport store from 'store-js';\nimport BarList from '../components/barList';\nimport TemplateStyle from '../components/templateStyle';\nimport ContentConfigPage from '../components/contentConfig';\nimport StyleConfigPage from '../components/styleConfig';\nimport TargetConfigPage from '../components/targetConfig';\nimport CustomCodePage from '../components/customCode';\nimport PreviewPage from '../components/preview';\nvar INJECT_SCRIPT = gql(_templateObject());\n\nfunction SaveUserPreference(props) {\n  var _useMutation = useMutation(INJECT_SCRIPT),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      injectScriptTag = _useMutation2[0],\n      _useMutation2$ = _useMutation2[1],\n      data = _useMutation2$.data,\n      error = _useMutation2$.error;\n\n  var handleInjectionSuccess = function handleInjectionSuccess(data, b) {\n    console.log(data);\n    setTimeout(function (b) {\n      b = 'dismiss';\n    }, 2500);\n    return b === 'success' ? __jsx(Toast, {\n      content: \"Saved successfully.\",\n      onDismiss: function onDismiss() {}\n    }) : b === 'error' ? __jsx(Toast, {\n      content: \"Something went wrong.\",\n      onDismiss: function onDismiss() {}\n    }) : null;\n  };\n\n  return __jsx(\"div\", {\n    style: {\n      marginTop: '50px',\n      height: '100px'\n    }\n  }, __jsx(ButtonGroup, null, __jsx(Button, {\n    onClick: function onClick() {\n      props.handleEdit();\n    }\n  }, \"Cancel\"), __jsx(Button, {\n    primary: true,\n    onClick: function onClick(e) {\n      e.preventDefault();\n      console.log('calling useMutation hooks'); // injectScriptTag({\n      //   variables:{\n      //     input:{\n      //       displayScope:'ONLINE_STORE',\n      //       src:'https://ec9baf76.ngrok.io/_next/static/chunks/topBarInjection.js'\n      //     }\n      //   }\n      // })\n\n      props.handleSaving();\n    }\n  }, \"Save\")), __jsx(Frame, null, data && handleInjectionSuccess(data, 'success'), error && handleInjectionSuccess(error, 'error')));\n}\n\nvar Index =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Index, _React$Component);\n\n  function Index(props) {\n    var _this;\n\n    _classCallCheck(this, Index);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Index).call(this, props));\n    _this.state = {\n      open: false,\n      onEdit: false,\n      savedName: '',\n      barTxtConfig: {\n        initialMsg1: '',\n        prgMsg1: '',\n        achievedMsg: ''\n      },\n      barFrShGl: 30,\n      barLink: {\n        url: '',\n        openNew: false\n      },\n      barPosition: '',\n      bgImg: {},\n      styleConfig: {\n        colorConfig: {\n          bgColor: '#000',\n          txtColor: '#b31219',\n          bgOpacity: 100,\n          specialColor: '#fff'\n        },\n        fontConfig: {\n          fontFamily: 'sans-serif'\n        }\n      },\n      customCode: {\n        script: '',\n        style: ''\n      },\n      dspOnPage: {\n        selected: '',\n        url: ''\n      },\n      shipsToCountries: [],\n      selectedTargets: ''\n    };\n    _this.baseState = _this.state;\n    _this.finalBars = React.createRef();\n    _this.handleEditId = _this.handleEditId.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(Index, [{\n    key: \"handleEditId\",\n    value: function handleEditId(id) {\n      console.log(id);\n      this.setState({\n        onEdit: true\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var emptyState = !store.get('ids');\n      var _this$state = this.state,\n          barTxtConfig = _this$state.barTxtConfig,\n          barFrShGl = _this$state.barFrShGl,\n          barLink = _this$state.barLink,\n          styleConfig = _this$state.styleConfig,\n          bgImg = _this$state.bgImg,\n          savedName = _this$state.savedName,\n          barPosition = _this$state.barPosition,\n          dspOnPage = _this$state.dspOnPage;\n      return __jsx(Page, null, __jsx(Layout.Section, null, __jsx(BarList, {\n        handleEditId: function handleEditId(id) {\n          return _this2.handleEditId(id);\n        },\n        handleTargetCountries: function handleTargetCountries(arr) {\n          return _this2.setState({\n            shipsToCountries: arr\n          }, function () {\n            console.log(this.state.shipsToCountries);\n          });\n        }\n      }), this.state.onEdit ? __jsx(\"div\", {\n        style: {\n          marginTop: '3em'\n        }\n      }, __jsx(TemplateStyle, {\n        handleClickedLi: function handleClickedLi(bg, ftColor) {\n          return _this2.setState({\n            styleConfig: _objectSpread({}, _this2.state.styleConfig, {\n              colorConfig: _objectSpread({}, _this2.state.styleConfig.colorConfig, {\n                bgColor: bg,\n                txtColor: ftColor\n              })\n            })\n          });\n        }\n      }), __jsx(PreviewPage, {\n        others: {\n          savedName: savedName,\n          barPosition: barPosition,\n          dspOnPage: dspOnPage\n        },\n        contentConfig: {\n          barTxtConfig: barTxtConfig,\n          barFrShGl: barFrShGl,\n          barLink: barLink\n        },\n        styleConfig: _objectSpread({}, styleConfig),\n        bgImg: bgImg,\n        ref: this.finalBars\n      }), __jsx(ContentConfigPage, {\n        handleContentConfig_msg: function handleContentConfig_msg(msg) {\n          return _this2.setState({\n            barTxtConfig: _objectSpread({}, _this2.barTxtConfig, msg)\n          });\n        },\n        handleContentConfig_goal: function handleContentConfig_goal(gl) {\n          return _this2.setState({\n            barFrShGl: gl\n          });\n        },\n        handleContentConfig_link: function handleContentConfig_link(val) {\n          return _this2.setState({\n            barLink: _objectSpread({}, _this2.state.barLink, val)\n          });\n        },\n        handleName: function handleName(name) {\n          return _this2.setState({\n            savedName: name\n          });\n        },\n        handleBarPosition: function handleBarPosition(p) {\n          return _this2.setState({\n            barPosition: p\n          });\n        }\n      }), __jsx(StyleConfigPage, _extends({\n        handleStyleConfig: function handleStyleConfig(colorCf, fontCf) {\n          _this2.setState({\n            styleConfig: {\n              colorConfig: colorCf,\n              fontConfig: fontCf\n            }\n          });\n        },\n        uploadBgImg: function uploadBgImg(bgFile) {\n          return _this2.setState({\n            bgImg: bgFile\n          });\n        }\n      }, this.state)), __jsx(TargetConfigPage, {\n        handleDisplayOnPage: function handleDisplayOnPage(sec, url) {\n          return _this2.setState({\n            dspOnPage: {\n              selected: sec,\n              url: url\n            }\n          });\n        },\n        shipsToCountries: this.state.shipsToCountries,\n        handleSelectedTargets: function handleSelectedTargets(val) {\n          return _this2.setState({\n            selectedTargets: val\n          });\n        }\n      }), __jsx(CustomCodePage, {\n        handleCustomCode: function handleCustomCode(script, style) {\n          _this2.setState({\n            customCode: {\n              script: script,\n              style: style\n            }\n          });\n        }\n      }), __jsx(SaveUserPreference, {\n        handleEdit: function handleEdit() {\n          _this2.setState(_this2.baseState);\n        },\n        handleSaving: function handleSaving() {\n          console.log(_this2.finalBars.current);\n        }\n      })) : null));\n    }\n  }]);\n\n  return Index;\n}(React.Component);\n\n;\nexport default Index;","map":{"version":3,"sources":["C:\\Users\\Administrator.SC-201903211547\\projects\\0919\\sample-embedded-app\\pages\\index.js"],"names":["Layout","Page","ButtonGroup","Button","Toast","Frame","useState","useCallback","gql","useMutation","useSubscription","store","BarList","TemplateStyle","ContentConfigPage","StyleConfigPage","TargetConfigPage","CustomCodePage","PreviewPage","INJECT_SCRIPT","SaveUserPreference","props","injectScriptTag","data","error","handleInjectionSuccess","b","console","log","setTimeout","marginTop","height","handleEdit","e","preventDefault","handleSaving","Index","state","open","onEdit","savedName","barTxtConfig","initialMsg1","prgMsg1","achievedMsg","barFrShGl","barLink","url","openNew","barPosition","bgImg","styleConfig","colorConfig","bgColor","txtColor","bgOpacity","specialColor","fontConfig","fontFamily","customCode","script","style","dspOnPage","selected","shipsToCountries","selectedTargets","baseState","finalBars","React","createRef","handleEditId","bind","id","setState","emptyState","get","arr","bg","ftColor","msg","gl","val","name","p","colorCf","fontCf","bgFile","sec","current","Component"],"mappings":"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","sourcesContent":["import { Layout, Page, ButtonGroup, Button, Toast, Frame } from '@shopify/polaris';\r\nimport { useState, useCallback } from 'react';\r\nimport gql from 'graphql-tag';\r\nimport { useMutation, useSubscription } from 'react-apollo';\r\nimport store from 'store-js';\r\n\r\nimport BarList from '../components/barList';\r\nimport TemplateStyle from '../components/templateStyle';\r\nimport ContentConfigPage from '../components/contentConfig';\r\nimport StyleConfigPage from '../components/styleConfig';\r\nimport TargetConfigPage from '../components/targetConfig';\r\nimport CustomCodePage from '../components/customCode';\r\nimport PreviewPage from '../components/preview';\r\n\r\nconst INJECT_SCRIPT = gql`\r\n  mutation scriptTagCreate($input: ScriptTagInput!) {\r\n    scriptTagCreate(input: $input) {\r\n      scriptTag {\r\n        id\r\n      }\r\n      userErrors {\r\n        field\r\n        message\r\n      }\r\n    }\r\n  }\r\n`;\r\n\r\nfunction SaveUserPreference(props){\r\n  const [injectScriptTag, {data,error}] = useMutation(INJECT_SCRIPT);\r\n\r\n  const handleInjectionSuccess = (data,b) =>{\r\n    console.log(data);\r\n    setTimeout((b) => {\r\n      b='dismiss'\r\n    }, 2500);\r\n    return (\r\n      b === 'success'? \r\n      <Toast\r\n        content=\"Saved successfully.\"\r\n        onDismiss={() => {}}\r\n      />\r\n      :\r\n      b === 'error' ?\r\n      <Toast\r\n        content=\"Something went wrong.\"\r\n        onDismiss={ () => {}}\r\n      />\r\n      :\r\n      null\r\n    )\r\n  };\r\n  \r\n  return (\r\n    <div style={{marginTop:'50px',height:'100px'}}>\r\n      <ButtonGroup>\r\n        <Button\r\n          onClick = {()=>{\r\n            props.handleEdit();\r\n          }}\r\n        >Cancel</Button>\r\n        <Button primary \r\n          onClick={(e)=>{\r\n            e.preventDefault();\r\n            console.log('calling useMutation hooks');\r\n            // injectScriptTag({\r\n            //   variables:{\r\n            //     input:{\r\n            //       displayScope:'ONLINE_STORE',\r\n            //       src:'https://ec9baf76.ngrok.io/_next/static/chunks/topBarInjection.js'\r\n            //     }\r\n            //   }\r\n            // })\r\n            props.handleSaving();\r\n          }}\r\n        >\r\n          Save\r\n        </Button>\r\n      </ButtonGroup>\r\n      <Frame>\r\n        { data && handleInjectionSuccess(data,'success')}\r\n        { error &&  handleInjectionSuccess(error,'error') }\r\n      </Frame>\r\n    </div>\r\n  )\r\n}\r\n\r\nclass Index extends React.Component {\r\n  constructor(props){\r\n    super(props);\r\n    this.state = {\r\n      open: false,\r\n      onEdit:false,\r\n      savedName:'',\r\n      barTxtConfig:{initialMsg1:'',prgMsg1:'',achievedMsg:''},\r\n      barFrShGl:30,\r\n      barLink:{url:'',openNew:false},\r\n      barPosition:'',\r\n      bgImg:{},\r\n      styleConfig:{colorConfig:{bgColor:'#000',txtColor:'#b31219',bgOpacity:100,specialColor:'#fff'},fontConfig:{fontFamily:'sans-serif'}},\r\n      customCode:{script:'',style:''},\r\n      dspOnPage:{selected:'',url:''},\r\n      shipsToCountries:[],\r\n      selectedTargets:''\r\n    };\r\n    this.baseState = this.state;\r\n    this.finalBars = React.createRef();\r\n    this.handleEditId = this.handleEditId.bind(this);\r\n  }\r\n\r\n  handleEditId(id){\r\n    console.log(id);\r\n    this.setState({onEdit:true});\r\n  }\r\n\r\n  render(){\r\n    const emptyState = !store.get('ids');\r\n    const {barTxtConfig,barFrShGl,barLink,styleConfig,bgImg,savedName,barPosition,dspOnPage} = this.state;\r\n    return (\r\n      <Page>\r\n        <Layout.Section>\r\n          <BarList \r\n            handleEditId={(id) => this.handleEditId(id)}\r\n            handleTargetCountries={(arr)=> this.setState({shipsToCountries:arr},function(){console.log(this.state.shipsToCountries)})}\r\n          />\r\n          {\r\n            this.state.onEdit?\r\n            <div style={{marginTop:'3em'}}>\r\n              <TemplateStyle handleClickedLi={(bg,ftColor) => this.setState({styleConfig:{...this.state.styleConfig,colorConfig:{...this.state.styleConfig.colorConfig,bgColor:bg,txtColor:ftColor}}})}/>\r\n              <PreviewPage \r\n                others={{savedName,barPosition,dspOnPage}}\r\n                contentConfig={{barTxtConfig,barFrShGl,barLink}} \r\n                styleConfig = {{...styleConfig}}\r\n                bgImg = {bgImg}\r\n                ref={this.finalBars}\r\n              />\r\n              <ContentConfigPage \r\n                handleContentConfig_msg={(msg)=> this.setState({barTxtConfig:{...this.barTxtConfig,...msg}})} \r\n                handleContentConfig_goal={(gl) => this.setState({barFrShGl:gl})}\r\n                handleContentConfig_link={(val)=> this.setState({barLink:{...this.state.barLink,...val}})}\r\n                handleName={(name)=> this.setState({savedName:name})}\r\n                handleBarPosition={(p)=> this.setState({barPosition:p})}\r\n              />\r\n              <StyleConfigPage \r\n                handleStyleConfig={(colorCf,fontCf) => {\r\n                  this.setState({styleConfig:{colorConfig:colorCf,fontConfig:fontCf}})\r\n                }}\r\n                uploadBgImg={(bgFile) => this.setState({bgImg:bgFile})}\r\n                {...this.state}\r\n              />\r\n              <TargetConfigPage \r\n                handleDisplayOnPage={(sec,url)=>this.setState({dspOnPage:{selected:sec,url:url}})}\r\n                shipsToCountries={this.state.shipsToCountries}\r\n                handleSelectedTargets={(val)=>this.setState({selectedTargets:val})}\r\n              />\r\n              <CustomCodePage handleCustomCode={(script,style) => {this.setState({customCode:{script:script,style:style}})}}/>\r\n              <SaveUserPreference \r\n                handleEdit={()=> {\r\n                  this.setState(this.baseState);\r\n                }}\r\n                handleSaving={()=>{\r\n                  console.log(this.finalBars.current);\r\n                }}\r\n              />\r\n            </div>\r\n            :\r\n            null\r\n          }\r\n        </Layout.Section>\r\n      </Page>\r\n    )\r\n  };\r\n\r\n};\r\n\r\nexport default Index;"]},"metadata":{},"sourceType":"module"}